<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width"><meta name="theme-color" content="#222"><meta name="generator" content="Hexo 7.3.0"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png"><link rel="icon" type="image/png" sizes="32x32" href="https://blogimg.d77.xyz/logo.png"><link rel="icon" type="image/png" sizes="16x16" href="https://blogimg.d77.xyz/logo.png"><link rel="mask-icon" href="/images/logo.svg" color="#222"><meta name="google-site-verification" content="k9WS1EOfLnS9AypLcsMakrYfXwMf0dUn-t3o0ISNMy4"><meta name="baidu-site-verification" content="GTIjN6Pg5u"><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css" integrity="sha256-dABdfBfUoC8vJUBOwGVdm8L9qlMWaHTIfXt+7GnZCIo=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancyapps-ui/5.0.31/fancybox/fancybox.css" integrity="sha256-gkQVf8UKZgQ0HyuxL/VnacadJ+D2Kox2TCEBuNQg5+w=" crossorigin="anonymous"><script class="next-config" data-name="main" type="application/json">{"hostname":"blog.d77.xyz","root":"/","images":"/images","scheme":"Pisces","darkmode":false,"version":"8.22.0","exturl":false,"sidebar":{"position":"left","width_expanded":320,"width_dual_column":240,"display":"post","padding":18,"offset":12},"hljswrap":true,"copycode":{"enable":true,"style":null},"fold":{"enable":false,"height":500},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":true,"pangu":true,"comments":{"style":"tabs","active":"disqus","storage":true,"lazyload":true,"nav":null},"stickytabs":false,"motion":{"enable":false,"async":false,"duration":200,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"}}</script><script src="/js/config.js"></script><meta name="description" content="引言应公司要求，数据库的敏感数据在写入到数据库中要进行加密，但是在测试环境查询数据的时候要手动解密，很不方便，有的时候数据比较多，解密比较麻烦。遂研究了一下如何通过 MySQL Workbench 的插件来实现查询数据一键解密。"><meta property="og:type" content="article"><meta property="og:title" content="可能是全网第一个MySQL Workbench插件编写技巧"><meta property="og:url" content="https://blog.d77.xyz/archives/f4f691af.html"><meta property="og:site_name" content="LLLibra146&#39;s blog"><meta property="og:description" content="引言应公司要求，数据库的敏感数据在写入到数据库中要进行加密，但是在测试环境查询数据的时候要手动解密，很不方便，有的时候数据比较多，解密比较麻烦。遂研究了一下如何通过 MySQL Workbench 的插件来实现查询数据一键解密。"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://blogimg.d77.xyz/image-20241112223339275.png"><meta property="og:image" content="https://blogimg.d77.xyz/image-20241112225116753.png"><meta property="og:image" content="https://blogimg.d77.xyz/image-20241112225341468.png"><meta property="og:image" content="https://blogimg.d77.xyz/image-20241112231017602.png"><meta property="og:image" content="https://blogimg.d77.xyz/image-20241112231212018.png"><meta property="og:image" content="https://blogimg.d77.xyz/image-20241112231237059.png"><meta property="og:image" content="https://blogimg.d77.xyz/qrcode_for_gh_10d7d04417bb_430.jpg"><meta property="article:published_time" content="2024-11-12T13:46:15.000Z"><meta property="article:modified_time" content="2025-05-13T15:31:04.643Z"><meta property="article:author" content="LLLibra146"><meta property="article:tag" content="MySQL"><meta property="article:tag" content="MySQL Workbench"><meta property="article:tag" content="插件"><meta property="article:tag" content="插件编写"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://blogimg.d77.xyz/image-20241112223339275.png"><link rel="canonical" href="https://blog.d77.xyz/archives/f4f691af.html"><script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"https://blog.d77.xyz/archives/f4f691af.html","path":"/archives/f4f691af.html","title":"可能是全网第一个MySQL Workbench插件编写技巧"}</script><script class="next-config" data-name="calendar" type="application/json">""</script><title>可能是全网第一个MySQL Workbench插件编写技巧 | LLLibra146's blog</title><script async src="https://www.googletagmanager.com/gtag/js?id=G-GR9YXDQ843"></script><script class="next-config" data-name="google_analytics" type="application/json">{"tracking_id":"G-GR9YXDQ843","only_pageview":false,"measure_protocol_api_secret":null}</script><script src="/js/third-party/analytics/google-analytics.js"></script><script src="/js/third-party/analytics/baidu-analytics.js"></script><script async src="https://hm.baidu.com/hm.js?c76c7b91ebcbf02b7fc1f26bf23121ff"></script><noscript><link rel="stylesheet" href="/css/noscript.css"></noscript></head><body itemscope itemtype="http://schema.org/WebPage"><div class="headband"></div><main class="main"><div class="column"><header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container"><div class="site-nav-toggle"><div class="toggle" aria-label="切换导航栏" role="button"><span class="toggle-line"></span> <span class="toggle-line"></span> <span class="toggle-line"></span></div></div><div class="site-meta"><a href="/" class="brand" rel="start"><i class="logo-line"></i><p class="site-title">LLLibra146's blog</p><i class="logo-line"></i></a><p class="site-subtitle" itemprop="description">Personal note</p></div><div class="site-nav-right"><div class="toggle popup-trigger" aria-label="搜索" role="button"></div></div></div><nav class="site-nav"><ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签<span class="badge">291</span></a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类<span class="badge">43</span></a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档<span class="badge">153</span></a></li></ul></nav></header><aside class="sidebar"><div class="sidebar-inner sidebar-nav-active sidebar-toc-active"><ul class="sidebar-nav"><li class="sidebar-nav-toc">文章目录</li><li class="sidebar-nav-overview">站点概览</li></ul><div class="sidebar-panel-container"><div class="post-toc-wrap sidebar-panel"><div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%BC%95%E8%A8%80"><span class="nav-number">1.</span> <span class="nav-text">引言</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%97%AE%E9%A2%98"><span class="nav-number">2.</span> <span class="nav-text">问题</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%8F%92%E4%BB%B6%E5%8E%9F%E7%90%86"><span class="nav-number">3.</span> <span class="nav-text">插件原理</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%8F%92%E4%BB%B6"><span class="nav-number">3.1.</span> <span class="nav-text">插件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AF%BC%E5%85%A5%E6%8F%92%E4%BB%B6"><span class="nav-number">3.2.</span> <span class="nav-text">导入插件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%8F%92%E4%BB%B6%E8%A6%81%E6%B1%82"><span class="nav-number">3.3.</span> <span class="nav-text">插件要求</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Script-Shell-%E6%9F%A5%E8%AF%A2"><span class="nav-number">4.</span> <span class="nav-text">Script Shell 查询</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%BC%96%E5%86%99%E6%8F%92%E4%BB%B6"><span class="nav-number">5.</span> <span class="nav-text">编写插件</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%8F%92%E4%BB%B6%E6%95%88%E6%9E%9C"><span class="nav-number">5.1.</span> <span class="nav-text">插件效果</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%8F%92%E4%BB%B6%E7%BC%96%E5%86%99"><span class="nav-number">6.</span> <span class="nav-text">插件编写</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9"><span class="nav-number">7.</span> <span class="nav-text">注意事项</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%80%BB%E7%BB%93"><span class="nav-number">8.</span> <span class="nav-text">总结</span></a></li></ol></div></div><div class="site-overview-wrap sidebar-panel"><div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="site-author-image" itemprop="image" alt="LLLibra146" src="https://blogimg.d77.xyz/logo.png"><p class="site-author-name" itemprop="name">LLLibra146</p><div class="site-description" itemprop="description"></div></div><div class="site-state-wrap animated"><nav class="site-state"><div class="site-state-item site-state-posts"><a href="/archives/"><span class="site-state-item-count">153</span> <span class="site-state-item-name">日志</span></a></div><div class="site-state-item site-state-categories"><a href="/categories/"><span class="site-state-item-count">43</span> <span class="site-state-item-name">分类</span></a></div><div class="site-state-item site-state-tags"><a href="/tags/"><span class="site-state-item-count">291</span> <span class="site-state-item-name">标签</span></a></div></nav></div><div class="links-of-author animated"><span class="links-of-author-item"><a href="https://github.com/libra146" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;libra146" rel="noopener me external nofollow noreferrer" target="_blank"><i class="github fa-fw"></i>GitHub</a> </span><span class="links-of-author-item"><a href="mailto:1462326016@qq.com" title="E-Mail → mailto:1462326016@qq.com" rel="noopener me external nofollow noreferrer" target="_blank"><i class="envelope fa-fw"></i>E-Mail</a></span></div></div></div></div></aside></div><div class="main-inner post posts-expand"><div class="post-block"><article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://blog.d77.xyz/archives/f4f691af.html"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="https://blogimg.d77.xyz/logo.png"><meta itemprop="name" content="LLLibra146"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="LLLibra146's blog"><meta itemprop="description" content=""></span><span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork"><meta itemprop="name" content="可能是全网第一个MySQL Workbench插件编写技巧 | LLLibra146's blog"><meta itemprop="description" content=""></span><header class="post-header"><h1 class="post-title" itemprop="name headline">可能是全网第一个MySQL Workbench插件编写技巧</h1><div class="post-meta-container"><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar"></i> </span><span class="post-meta-item-text">发表于</span> <time title="创建时间：2024-11-12 21:46:15 21:46:15" itemprop="dateCreated datePublished" datetime="2024-11-12T21:46:15+08:00">2024-11-12 21:46:15</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar-check"></i> </span><span class="post-meta-item-text">更新于</span> <time title="修改时间：2025-05-13 23:31:04 23:31:04" itemprop="dateModified" datetime="2025-05-13T23:31:04+08:00">2025-05-13 23:31:04</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-folder"></i> </span><span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/MySQL/" itemprop="url" rel="index"><span itemprop="name">MySQL</span></a></span></span></div></div></header><div class="post-body" itemprop="articleBody"><h2 id="引言"><a href="#引言" class="headerlink" title="引言"></a>引言</h2><p>应公司要求，数据库的敏感数据在写入到数据库中要进行加密，但是在测试环境查询数据的时候要手动解密，很不方便，有的时候数据比较多，解密比较麻烦。遂研究了一下如何通过 MySQL Workbench 的插件来实现查询数据一键解密。</p><span id="more"></span><h2 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h2><p>之前已经通过 <code>mybatis</code> 拦截器实现了自动加解密的功能，并且可以兼容 <code>LambdaQueryWrapper</code>，<code>QueryWrapper</code>，<code>Mapper</code> 等查询方式，现在要解决的问题是通过插件自动解密数据。</p><h2 id="插件原理"><a href="#插件原理" class="headerlink" title="插件原理"></a>插件原理</h2><p>要想写 MySQL Workbench 插件，要先了解 MySQL Workbench 的原理。</p><h3 id="插件"><a href="#插件" class="headerlink" title="插件"></a>插件</h3><p>查看<a target="_blank" rel="noopener external nofollow noreferrer" href="https://dev.mysql.com/doc/workbench/en/wb-extending.html">官方文档</a>，MySQL Workbench 的核心使用 C++ 写的，但是留了大量的拓展接口，可以通过 Python 包装的方式来控制。例如可以通过 Python 创建一些界面，可以执行一些数据处理数据转换的逻辑等等，官方的用户模块文件夹中有大量的 Python 文件，感兴趣的小伙伴可以自行查看学习。</p><p><img data-src="https://blogimg.d77.xyz/image-20241112223339275.png" alt="image-20241112223339275"></p><h3 id="导入插件"><a href="#导入插件" class="headerlink" title="导入插件"></a>导入插件</h3><p>MySQL Workbench 中的插件都是通过<a target="_blank" rel="noopener external nofollow noreferrer" href="https://dev.mysql.com/doc/workbench/en/wb-modules.html">模块</a>的方式导入的，一些拓展的插件都是完全通过 Python 脚本实现的。MySQL Workbench 内置了 Python 3.12，可以执行所有的 Python 脚本，所有的插件都放到一个 <code>modules</code> 的文件夹里面。细节文档这里不放了，可以查看文中的链接。</p><h3 id="插件要求"><a href="#插件要求" class="headerlink" title="插件要求"></a>插件要求</h3><p>插件的编写有几个要求：</p><ol><li>源文件必须位于用户模块文件夹中。用户模块文件夹路径如下</li></ol><table><thead><tr><th align="left">Operating System</th><th align="left">File Path</th></tr></thead><tbody><tr><td align="left">Windows</td><td align="left">%AppData%\MySQL\Workbench\modules</td></tr><tr><td align="left">macOS</td><td align="left">~username&#x2F;Library&#x2F;Application Support&#x2F;MySQL&#x2F;Workbench&#x2F;modules</td></tr><tr><td align="left">Linux</td><td align="left">~username&#x2F;.mysql&#x2F;workbench&#x2F;modules</td></tr></tbody></table><ol start="2"><li>模块文件名必须以 <code>_grt.py</code> 结尾，例如：<code>my_module_grt.py</code></li><li>必须通过 <code>DefineModule</code> 为插件添加元数据。例如：</li></ol><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> wb <span class="keyword">import</span> *</span><br><span class="line">ModuleInfo = DefineModule(name=<span class="string">&#x27;MyModule&#x27;</span>, author=<span class="string">&#x27;Your Name&#x27;</span>, version=<span class="string">&#x27;1.0&#x27;</span>)</span><br></pre></td></tr></table></figure><ol start="4"><li>插件方法需要通过进行签名，指定方法的返回值类型和参数个数，参数类型。</li></ol><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ModuleInfo.export(<span class="params">grt.INT, grt.STRING</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">checkString</span>(<span class="params">s</span>):</span><br><span class="line">   ...</span><br></pre></td></tr></table></figure><p>看一下官方的 demo：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> wb <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> grt</span><br><span class="line"></span><br><span class="line">ModuleInfo = DefineModule(name=<span class="string">&#x27;MyModule&#x27;</span>, author=<span class="string">&quot;your name&quot;</span>, version=<span class="string">&#x27;1.0&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">@ModuleInfo.export(<span class="params">grt.DOUBLE, grt.STRING, (<span class="params">grt.LIST, grt.DOUBLE</span>)</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">printListSum</span>(<span class="params">message, doubleList</span>):</span><br><span class="line">   <span class="built_in">sum</span> = <span class="number">0</span></span><br><span class="line">   <span class="keyword">for</span> d <span class="keyword">in</span> doubleList:</span><br><span class="line">      <span class="built_in">sum</span> = <span class="built_in">sum</span> + d</span><br><span class="line">   <span class="built_in">print</span> message, <span class="built_in">sum</span></span><br><span class="line">   <span class="keyword">return</span> <span class="built_in">sum</span></span><br></pre></td></tr></table></figure><h2 id="Script-Shell-查询"><a href="#Script-Shell-查询" class="headerlink" title="Script Shell 查询"></a>Script Shell 查询</h2><p>Script Shell 是一个可以执行脚本，查看 MySQL Workbench 拓展接口文档的工具，打开方式如下：</p><p><img data-src="https://blogimg.d77.xyz/image-20241112225116753.png" alt="image-20241112225116753"></p><p>查看下面的 <code>Classes</code> 选项卡，本次需求使用到了 <code>db.query.Resultset</code> 对象，可以在这里找到 <code>Resultset</code> 对象的方法和属性。MySQL Workbench 提供了大量的对象，如果有其他需求的小伙伴可以研究一下其他的对象如何使用，用得好的话拓展性很高。</p><p><img data-src="https://blogimg.d77.xyz/image-20241112225341468.png" alt="image-20241112225341468"></p><h2 id="编写插件"><a href="#编写插件" class="headerlink" title="编写插件"></a>编写插件</h2><p>前面铺垫完了，开始看本次分享的插件吧。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">import</span> binascii</span><br><span class="line"><span class="keyword">from</span> base64 <span class="keyword">import</span> b64encode, b64decode</span><br><span class="line"><span class="keyword">from</span> binascii <span class="keyword">import</span> hexlify, unhexlify</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> grt</span><br><span class="line"><span class="keyword">from</span> wb <span class="keyword">import</span> DefineModule, wbinputs</span><br><span class="line"><span class="keyword">from</span> workbench.log <span class="keyword">import</span> log_info</span><br><span class="line"></span><br><span class="line">key = binascii.unhexlify(<span class="string">&#x27;你的key，十六进制字符串&#x27;</span>)</span><br><span class="line"><span class="comment"># python3</span></span><br><span class="line">PY2 = <span class="literal">False</span></span><br><span class="line">PY3 = <span class="literal">True</span></span><br><span class="line"></span><br><span class="line">_<span class="built_in">range</span> = <span class="built_in">range</span></span><br><span class="line">string_types = (<span class="built_in">str</span>,)</span><br><span class="line">text_type = <span class="built_in">str</span></span><br><span class="line">binary_type = <span class="built_in">bytes</span></span><br><span class="line"></span><br><span class="line">E_FMT = <span class="string">&#x27;UTF8&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># S盒</span></span><br><span class="line">S_BOX = &#123;</span><br><span class="line">    <span class="number">0X00</span>: <span class="number">0XD6</span>, <span class="number">0X01</span>: <span class="number">0X90</span>, <span class="number">0X02</span>: <span class="number">0XE9</span>, <span class="number">0X03</span>: <span class="number">0XFE</span>, <span class="number">0X04</span>: <span class="number">0XCC</span>, <span class="number">0X05</span>: <span class="number">0XE1</span>, <span class="number">0X06</span>: <span class="number">0X3D</span>, <span class="number">0X07</span>: <span class="number">0XB7</span>,</span><br><span class="line">    <span class="number">0X08</span>: <span class="number">0X16</span>, <span class="number">0X09</span>: <span class="number">0XB6</span>, <span class="number">0X0A</span>: <span class="number">0X14</span>, <span class="number">0X0B</span>: <span class="number">0XC2</span>, <span class="number">0X0C</span>: <span class="number">0X28</span>, <span class="number">0X0D</span>: <span class="number">0XFB</span>, <span class="number">0X0E</span>: <span class="number">0X2C</span>, <span class="number">0X0F</span>: <span class="number">0X05</span>,</span><br><span class="line">    <span class="number">0X10</span>: <span class="number">0X2B</span>, <span class="number">0X11</span>: <span class="number">0X67</span>, <span class="number">0X12</span>: <span class="number">0X9A</span>, <span class="number">0X13</span>: <span class="number">0X76</span>, <span class="number">0X14</span>: <span class="number">0X2A</span>, <span class="number">0X15</span>: <span class="number">0XBE</span>, <span class="number">0X16</span>: <span class="number">0X04</span>, <span class="number">0X17</span>: <span class="number">0XC3</span>,</span><br><span class="line">    <span class="number">0X18</span>: <span class="number">0XAA</span>, <span class="number">0X19</span>: <span class="number">0X44</span>, <span class="number">0X1A</span>: <span class="number">0X13</span>, <span class="number">0X1B</span>: <span class="number">0X26</span>, <span class="number">0X1C</span>: <span class="number">0X49</span>, <span class="number">0X1D</span>: <span class="number">0X86</span>, <span class="number">0X1E</span>: <span class="number">0X06</span>, <span class="number">0X1F</span>: <span class="number">0X99</span>,</span><br><span class="line">    <span class="number">0X20</span>: <span class="number">0X9C</span>, <span class="number">0X21</span>: <span class="number">0X42</span>, <span class="number">0X22</span>: <span class="number">0X50</span>, <span class="number">0X23</span>: <span class="number">0XF4</span>, <span class="number">0X24</span>: <span class="number">0X91</span>, <span class="number">0X25</span>: <span class="number">0XEF</span>, <span class="number">0X26</span>: <span class="number">0X98</span>, <span class="number">0X27</span>: <span class="number">0X7A</span>,</span><br><span class="line">    <span class="number">0X28</span>: <span class="number">0X33</span>, <span class="number">0X29</span>: <span class="number">0X54</span>, <span class="number">0X2A</span>: <span class="number">0X0B</span>, <span class="number">0X2B</span>: <span class="number">0X43</span>, <span class="number">0X2C</span>: <span class="number">0XED</span>, <span class="number">0X2D</span>: <span class="number">0XCF</span>, <span class="number">0X2E</span>: <span class="number">0XAC</span>, <span class="number">0X2F</span>: <span class="number">0X62</span>,</span><br><span class="line">    <span class="number">0X30</span>: <span class="number">0XE4</span>, <span class="number">0X31</span>: <span class="number">0XB3</span>, <span class="number">0X32</span>: <span class="number">0X1C</span>, <span class="number">0X33</span>: <span class="number">0XA9</span>, <span class="number">0X34</span>: <span class="number">0XC9</span>, <span class="number">0X35</span>: <span class="number">0X08</span>, <span class="number">0X36</span>: <span class="number">0XE8</span>, <span class="number">0X37</span>: <span class="number">0X95</span>,</span><br><span class="line">    <span class="number">0X38</span>: <span class="number">0X80</span>, <span class="number">0X39</span>: <span class="number">0XDF</span>, <span class="number">0X3A</span>: <span class="number">0X94</span>, <span class="number">0X3B</span>: <span class="number">0XFA</span>, <span class="number">0X3C</span>: <span class="number">0X75</span>, <span class="number">0X3D</span>: <span class="number">0X8F</span>, <span class="number">0X3E</span>: <span class="number">0X3F</span>, <span class="number">0X3F</span>: <span class="number">0XA6</span>,</span><br><span class="line">    <span class="number">0X40</span>: <span class="number">0X47</span>, <span class="number">0X41</span>: <span class="number">0X07</span>, <span class="number">0X42</span>: <span class="number">0XA7</span>, <span class="number">0X43</span>: <span class="number">0XFC</span>, <span class="number">0X44</span>: <span class="number">0XF3</span>, <span class="number">0X45</span>: <span class="number">0X73</span>, <span class="number">0X46</span>: <span class="number">0X17</span>, <span class="number">0X47</span>: <span class="number">0XBA</span>,</span><br><span class="line">    <span class="number">0X48</span>: <span class="number">0X83</span>, <span class="number">0X49</span>: <span class="number">0X59</span>, <span class="number">0X4A</span>: <span class="number">0X3C</span>, <span class="number">0X4B</span>: <span class="number">0X19</span>, <span class="number">0X4C</span>: <span class="number">0XE6</span>, <span class="number">0X4D</span>: <span class="number">0X85</span>, <span class="number">0X4E</span>: <span class="number">0X4F</span>, <span class="number">0X4F</span>: <span class="number">0XA8</span>,</span><br><span class="line">    <span class="number">0X50</span>: <span class="number">0X68</span>, <span class="number">0X51</span>: <span class="number">0X6B</span>, <span class="number">0X52</span>: <span class="number">0X81</span>, <span class="number">0X53</span>: <span class="number">0XB2</span>, <span class="number">0X54</span>: <span class="number">0X71</span>, <span class="number">0X55</span>: <span class="number">0X64</span>, <span class="number">0X56</span>: <span class="number">0XDA</span>, <span class="number">0X57</span>: <span class="number">0X8B</span>,</span><br><span class="line">    <span class="number">0X58</span>: <span class="number">0XF8</span>, <span class="number">0X59</span>: <span class="number">0XEB</span>, <span class="number">0X5A</span>: <span class="number">0X0F</span>, <span class="number">0X5B</span>: <span class="number">0X4B</span>, <span class="number">0X5C</span>: <span class="number">0X70</span>, <span class="number">0X5D</span>: <span class="number">0X56</span>, <span class="number">0X5E</span>: <span class="number">0X9D</span>, <span class="number">0X5F</span>: <span class="number">0X35</span>,</span><br><span class="line">    <span class="number">0X60</span>: <span class="number">0X1E</span>, <span class="number">0X61</span>: <span class="number">0X24</span>, <span class="number">0X62</span>: <span class="number">0X0E</span>, <span class="number">0X63</span>: <span class="number">0X5E</span>, <span class="number">0X64</span>: <span class="number">0X63</span>, <span class="number">0X65</span>: <span class="number">0X58</span>, <span class="number">0X66</span>: <span class="number">0XD1</span>, <span class="number">0X67</span>: <span class="number">0XA2</span>,</span><br><span class="line">    <span class="number">0X68</span>: <span class="number">0X25</span>, <span class="number">0X69</span>: <span class="number">0X22</span>, <span class="number">0X6A</span>: <span class="number">0X7C</span>, <span class="number">0X6B</span>: <span class="number">0X3B</span>, <span class="number">0X6C</span>: <span class="number">0X01</span>, <span class="number">0X6D</span>: <span class="number">0X21</span>, <span class="number">0X6E</span>: <span class="number">0X78</span>, <span class="number">0X6F</span>: <span class="number">0X87</span>,</span><br><span class="line">    <span class="number">0X70</span>: <span class="number">0XD4</span>, <span class="number">0X71</span>: <span class="number">0X00</span>, <span class="number">0X72</span>: <span class="number">0X46</span>, <span class="number">0X73</span>: <span class="number">0X57</span>, <span class="number">0X74</span>: <span class="number">0X9F</span>, <span class="number">0X75</span>: <span class="number">0XD3</span>, <span class="number">0X76</span>: <span class="number">0X27</span>, <span class="number">0X77</span>: <span class="number">0X52</span>,</span><br><span class="line">    <span class="number">0X78</span>: <span class="number">0X4C</span>, <span class="number">0X79</span>: <span class="number">0X36</span>, <span class="number">0X7A</span>: <span class="number">0X02</span>, <span class="number">0X7B</span>: <span class="number">0XE7</span>, <span class="number">0X7C</span>: <span class="number">0XA0</span>, <span class="number">0X7D</span>: <span class="number">0XC4</span>, <span class="number">0X7E</span>: <span class="number">0XC8</span>, <span class="number">0X7F</span>: <span class="number">0X9E</span>,</span><br><span class="line">    <span class="number">0X80</span>: <span class="number">0XEA</span>, <span class="number">0X81</span>: <span class="number">0XBF</span>, <span class="number">0X82</span>: <span class="number">0X8A</span>, <span class="number">0X83</span>: <span class="number">0XD2</span>, <span class="number">0X84</span>: <span class="number">0X40</span>, <span class="number">0X85</span>: <span class="number">0XC7</span>, <span class="number">0X86</span>: <span class="number">0X38</span>, <span class="number">0X87</span>: <span class="number">0XB5</span>,</span><br><span class="line">    <span class="number">0X88</span>: <span class="number">0XA3</span>, <span class="number">0X89</span>: <span class="number">0XF7</span>, <span class="number">0X8A</span>: <span class="number">0XF2</span>, <span class="number">0X8B</span>: <span class="number">0XCE</span>, <span class="number">0X8C</span>: <span class="number">0XF9</span>, <span class="number">0X8D</span>: <span class="number">0X61</span>, <span class="number">0X8E</span>: <span class="number">0X15</span>, <span class="number">0X8F</span>: <span class="number">0XA1</span>,</span><br><span class="line">    <span class="number">0X90</span>: <span class="number">0XE0</span>, <span class="number">0X91</span>: <span class="number">0XAE</span>, <span class="number">0X92</span>: <span class="number">0X5D</span>, <span class="number">0X93</span>: <span class="number">0XA4</span>, <span class="number">0X94</span>: <span class="number">0X9B</span>, <span class="number">0X95</span>: <span class="number">0X34</span>, <span class="number">0X96</span>: <span class="number">0X1A</span>, <span class="number">0X97</span>: <span class="number">0X55</span>,</span><br><span class="line">    <span class="number">0X98</span>: <span class="number">0XAD</span>, <span class="number">0X99</span>: <span class="number">0X93</span>, <span class="number">0X9A</span>: <span class="number">0X32</span>, <span class="number">0X9B</span>: <span class="number">0X30</span>, <span class="number">0X9C</span>: <span class="number">0XF5</span>, <span class="number">0X9D</span>: <span class="number">0X8C</span>, <span class="number">0X9E</span>: <span class="number">0XB1</span>, <span class="number">0X9F</span>: <span class="number">0XE3</span>,</span><br><span class="line">    <span class="number">0XA0</span>: <span class="number">0X1D</span>, <span class="number">0XA1</span>: <span class="number">0XF6</span>, <span class="number">0XA2</span>: <span class="number">0XE2</span>, <span class="number">0XA3</span>: <span class="number">0X2E</span>, <span class="number">0XA4</span>: <span class="number">0X82</span>, <span class="number">0XA5</span>: <span class="number">0X66</span>, <span class="number">0XA6</span>: <span class="number">0XCA</span>, <span class="number">0XA7</span>: <span class="number">0X60</span>,</span><br><span class="line">    <span class="number">0XA8</span>: <span class="number">0XC0</span>, <span class="number">0XA9</span>: <span class="number">0X29</span>, <span class="number">0XAA</span>: <span class="number">0X23</span>, <span class="number">0XAB</span>: <span class="number">0XAB</span>, <span class="number">0XAC</span>: <span class="number">0X0D</span>, <span class="number">0XAD</span>: <span class="number">0X53</span>, <span class="number">0XAE</span>: <span class="number">0X4E</span>, <span class="number">0XAF</span>: <span class="number">0X6F</span>,</span><br><span class="line">    <span class="number">0XB0</span>: <span class="number">0XD5</span>, <span class="number">0XB1</span>: <span class="number">0XDB</span>, <span class="number">0XB2</span>: <span class="number">0X37</span>, <span class="number">0XB3</span>: <span class="number">0X45</span>, <span class="number">0XB4</span>: <span class="number">0XDE</span>, <span class="number">0XB5</span>: <span class="number">0XFD</span>, <span class="number">0XB6</span>: <span class="number">0X8E</span>, <span class="number">0XB7</span>: <span class="number">0X2F</span>,</span><br><span class="line">    <span class="number">0XB8</span>: <span class="number">0X03</span>, <span class="number">0XB9</span>: <span class="number">0XFF</span>, <span class="number">0XBA</span>: <span class="number">0X6A</span>, <span class="number">0XBB</span>: <span class="number">0X72</span>, <span class="number">0XBC</span>: <span class="number">0X6D</span>, <span class="number">0XBD</span>: <span class="number">0X6C</span>, <span class="number">0XBE</span>: <span class="number">0X5B</span>, <span class="number">0XBF</span>: <span class="number">0X51</span>,</span><br><span class="line">    <span class="number">0XC0</span>: <span class="number">0X8D</span>, <span class="number">0XC1</span>: <span class="number">0X1B</span>, <span class="number">0XC2</span>: <span class="number">0XAF</span>, <span class="number">0XC3</span>: <span class="number">0X92</span>, <span class="number">0XC4</span>: <span class="number">0XBB</span>, <span class="number">0XC5</span>: <span class="number">0XDD</span>, <span class="number">0XC6</span>: <span class="number">0XBC</span>, <span class="number">0XC7</span>: <span class="number">0X7F</span>,</span><br><span class="line">    <span class="number">0XC8</span>: <span class="number">0X11</span>, <span class="number">0XC9</span>: <span class="number">0XD9</span>, <span class="number">0XCA</span>: <span class="number">0X5C</span>, <span class="number">0XCB</span>: <span class="number">0X41</span>, <span class="number">0XCC</span>: <span class="number">0X1F</span>, <span class="number">0XCD</span>: <span class="number">0X10</span>, <span class="number">0XCE</span>: <span class="number">0X5A</span>, <span class="number">0XCF</span>: <span class="number">0XD8</span>,</span><br><span class="line">    <span class="number">0XD0</span>: <span class="number">0X0A</span>, <span class="number">0XD1</span>: <span class="number">0XC1</span>, <span class="number">0XD2</span>: <span class="number">0X31</span>, <span class="number">0XD3</span>: <span class="number">0X88</span>, <span class="number">0XD4</span>: <span class="number">0XA5</span>, <span class="number">0XD5</span>: <span class="number">0XCD</span>, <span class="number">0XD6</span>: <span class="number">0X7B</span>, <span class="number">0XD7</span>: <span class="number">0XBD</span>,</span><br><span class="line">    <span class="number">0XD8</span>: <span class="number">0X2D</span>, <span class="number">0XD9</span>: <span class="number">0X74</span>, <span class="number">0XDA</span>: <span class="number">0XD0</span>, <span class="number">0XDB</span>: <span class="number">0X12</span>, <span class="number">0XDC</span>: <span class="number">0XB8</span>, <span class="number">0XDD</span>: <span class="number">0XE5</span>, <span class="number">0XDE</span>: <span class="number">0XB4</span>, <span class="number">0XDF</span>: <span class="number">0XB0</span>,</span><br><span class="line">    <span class="number">0XE0</span>: <span class="number">0X89</span>, <span class="number">0XE1</span>: <span class="number">0X69</span>, <span class="number">0XE2</span>: <span class="number">0X97</span>, <span class="number">0XE3</span>: <span class="number">0X4A</span>, <span class="number">0XE4</span>: <span class="number">0X0C</span>, <span class="number">0XE5</span>: <span class="number">0X96</span>, <span class="number">0XE6</span>: <span class="number">0X77</span>, <span class="number">0XE7</span>: <span class="number">0X7E</span>,</span><br><span class="line">    <span class="number">0XE8</span>: <span class="number">0X65</span>, <span class="number">0XE9</span>: <span class="number">0XB9</span>, <span class="number">0XEA</span>: <span class="number">0XF1</span>, <span class="number">0XEB</span>: <span class="number">0X09</span>, <span class="number">0XEC</span>: <span class="number">0XC5</span>, <span class="number">0XED</span>: <span class="number">0X6E</span>, <span class="number">0XEE</span>: <span class="number">0XC6</span>, <span class="number">0XEF</span>: <span class="number">0X84</span>,</span><br><span class="line">    <span class="number">0XF0</span>: <span class="number">0X18</span>, <span class="number">0XF1</span>: <span class="number">0XF0</span>, <span class="number">0XF2</span>: <span class="number">0X7D</span>, <span class="number">0XF3</span>: <span class="number">0XEC</span>, <span class="number">0XF4</span>: <span class="number">0X3A</span>, <span class="number">0XF5</span>: <span class="number">0XDC</span>, <span class="number">0XF6</span>: <span class="number">0X4D</span>, <span class="number">0XF7</span>: <span class="number">0X20</span>,</span><br><span class="line">    <span class="number">0XF8</span>: <span class="number">0X79</span>, <span class="number">0XF9</span>: <span class="number">0XEE</span>, <span class="number">0XFA</span>: <span class="number">0X5F</span>, <span class="number">0XFB</span>: <span class="number">0X3E</span>, <span class="number">0XFC</span>: <span class="number">0XD7</span>, <span class="number">0XFD</span>: <span class="number">0XCB</span>, <span class="number">0XFE</span>: <span class="number">0X39</span>, <span class="number">0XFF</span>: <span class="number">0X48</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 系统参数FK</span></span><br><span class="line">FK = (<span class="number">0XA3B1BAC6</span>, <span class="number">0X56AA3350</span>, <span class="number">0X677D9197</span>, <span class="number">0XB27022DC</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 固定参数CK</span></span><br><span class="line">CK = (<span class="number">0X00070E15</span>, <span class="number">0X1C232A31</span>, <span class="number">0X383F464D</span>, <span class="number">0X545B6269</span>,</span><br><span class="line">      <span class="number">0X70777E85</span>, <span class="number">0X8C939AA1</span>, <span class="number">0XA8AFB6BD</span>, <span class="number">0XC4CBD2D9</span>,</span><br><span class="line">      <span class="number">0XE0E7EEF5</span>, <span class="number">0XFC030A11</span>, <span class="number">0X181F262D</span>, <span class="number">0X343B4249</span>,</span><br><span class="line">      <span class="number">0X50575E65</span>, <span class="number">0X6C737A81</span>, <span class="number">0X888F969D</span>, <span class="number">0XA4ABB2B9</span>,</span><br><span class="line">      <span class="number">0XC0C7CED5</span>, <span class="number">0XDCE3EAF1</span>, <span class="number">0XF8FF060D</span>, <span class="number">0X141B2229</span>,</span><br><span class="line">      <span class="number">0X30373E45</span>, <span class="number">0X4C535A61</span>, <span class="number">0X686F767D</span>, <span class="number">0X848B9299</span>,</span><br><span class="line">      <span class="number">0XA0A7AEB5</span>, <span class="number">0XBCC3CAD1</span>, <span class="number">0XD8DFE6ED</span>, <span class="number">0XF4FB0209</span>,</span><br><span class="line">      <span class="number">0X10171E25</span>, <span class="number">0X2C333A41</span>, <span class="number">0X484F565D</span>, <span class="number">0X646B7279</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 轮密钥缓存</span></span><br><span class="line">_rk_cache = &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 加密</span></span><br><span class="line">SM4_ENCRYPT = <span class="number">1</span></span><br><span class="line"><span class="comment"># 解密</span></span><br><span class="line">SM4_DECRYPT = <span class="number">0</span></span><br><span class="line"><span class="comment"># 分组byte数</span></span><br><span class="line">BLOCK_BYTE = <span class="number">16</span></span><br><span class="line">BLOCK_HEX = BLOCK_BYTE * <span class="number">2</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">num2hex</span>(<span class="params">num, width=<span class="number">1</span></span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    整数转为指定长度的十六进制字符串，不足补0</span></span><br><span class="line"><span class="string">    &gt;&gt;&gt; num2hex(1000, width=4)</span></span><br><span class="line"><span class="string">    &#x27;03e8&#x27;</span></span><br><span class="line"><span class="string">    :param num: 整数</span></span><br><span class="line"><span class="string">    :param width: 16进制字符串长度， 默认为1</span></span><br><span class="line"><span class="string">    :return str</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;&#123;:0&gt;&#123;width&#125;&#125;&#x27;</span>.<span class="built_in">format</span>(<span class="built_in">hex</span>(num)[<span class="number">2</span>:].replace(<span class="string">&#x27;L&#x27;</span>, <span class="string">&#x27;&#x27;</span>),</span><br><span class="line">                                 width=width)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">_byte_unpack</span>(<span class="params">num, byte_n=<span class="number">4</span></span>):</span><br><span class="line">    <span class="comment"># 分解后元组长度</span></span><br><span class="line">    _<span class="built_in">len</span> = <span class="number">4</span></span><br><span class="line">    <span class="comment"># 步长</span></span><br><span class="line">    step = (byte_n // _<span class="built_in">len</span>) * <span class="number">2</span></span><br><span class="line">    hex_str = num2hex(num=num, width=byte_n * <span class="number">2</span>)</span><br><span class="line">    split_v = <span class="built_in">list</span>(_<span class="built_in">range</span>(<span class="built_in">len</span>(hex_str)))[::step] + [<span class="built_in">len</span>(hex_str)]</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">tuple</span>([<span class="built_in">int</span>(hex_str[s:e], base=<span class="number">16</span>) <span class="keyword">for</span> s, e <span class="keyword">in</span></span><br><span class="line">                  <span class="built_in">zip</span>(split_v[:-<span class="number">1</span>], split_v[<span class="number">1</span>:])])</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">_byte_pack</span>(<span class="params">byte_array, byte_n=<span class="number">4</span></span>):</span><br><span class="line">    _<span class="built_in">len</span> = <span class="number">4</span></span><br><span class="line">    <span class="comment"># byte_array每一项16进制字符串的长度</span></span><br><span class="line">    width = (byte_n // _<span class="built_in">len</span>) * <span class="number">2</span></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(byte_array) != _<span class="built_in">len</span>:</span><br><span class="line">        <span class="keyword">raise</span> ValueError(<span class="string">&#x27;byte_array length must be 4.&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">int</span>(<span class="string">&#x27;&#x27;</span>.join([num2hex(num=v, width=width)</span><br><span class="line">                        <span class="keyword">for</span> v <span class="keyword">in</span> byte_array]), <span class="number">16</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">_s_box</span>(<span class="params">byte</span>):</span><br><span class="line">    <span class="keyword">return</span> S_BOX.get(byte)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">_non_linear_map</span>(<span class="params">byte_array</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    非线性变换, 输入A=(a0, a1, a2, a3)</span></span><br><span class="line"><span class="string">    (b0, b1, b2, b3) = (Sbox(a0), Sbox(a1), Sbox(a2), Sbox(a3))</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">return</span> (_s_box(byte_array[<span class="number">0</span>]), _s_box(byte_array[<span class="number">1</span>]),</span><br><span class="line">            _s_box(byte_array[<span class="number">2</span>]), _s_box(byte_array[<span class="number">3</span>]))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">_linear_map</span>(<span class="params">byte4</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    线性变换L</span></span><br><span class="line"><span class="string">    L(B) = B ⊕ (B &lt;&lt;&lt; 2) ⊕ (B &lt;&lt;&lt; 10) ⊕ (B &lt;&lt;&lt; 18) ⊕ (B &lt;&lt;&lt; 24)</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    _left = loop_left_shift</span><br><span class="line">    <span class="keyword">return</span> byte4 ^ _left(byte4, <span class="number">2</span>) ^ _left(byte4, <span class="number">10</span>) ^ _left(byte4, <span class="number">18</span>) ^ _left(byte4, <span class="number">24</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">_linear_map_s</span>(<span class="params">byte4</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    线性变换L&#x27;</span></span><br><span class="line"><span class="string">    L&#x27;(B) = B ⊕ (B &lt;&lt;&lt; 13) ⊕ (B &lt;&lt;&lt; 23)</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    _left = loop_left_shift</span><br><span class="line">    <span class="keyword">return</span> byte4 ^ _left(byte4, <span class="number">13</span>) ^ _left(byte4, <span class="number">23</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">loop_left_shift</span>(<span class="params">num, offset, base=<span class="number">32</span></span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    循环向左移位</span></span><br><span class="line"><span class="string">    &gt;&gt;&gt; loop_left_shift(0b11010000, 3, base=8)</span></span><br><span class="line"><span class="string">    &gt;&gt;&gt; 0b10000110</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    bin_str = <span class="string">&#x27;&#123;:0&gt;&#123;width&#125;&#125;&#x27;</span>.<span class="built_in">format</span>(<span class="built_in">bin</span>(num)[<span class="number">2</span>:], width=base)</span><br><span class="line">    rem = offset % base</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">int</span>(bin_str[rem:] + bin_str[:rem], <span class="number">2</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">_rep_t</span>(<span class="params">byte4</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;合成置换T, 由非线性变换和线性变换L复合而成&quot;&quot;&quot;</span></span><br><span class="line">    <span class="comment"># 非线性变换</span></span><br><span class="line">    b_array = _non_linear_map(_byte_unpack(byte4))</span><br><span class="line">    <span class="comment"># 线性变换L</span></span><br><span class="line">    <span class="keyword">return</span> _linear_map(_byte_pack(b_array))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">_rep_t_s</span>(<span class="params">byte4</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    合成置换T&#x27;, 由非线性变换和线性变换L&#x27;复合而成</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="comment"># 非线性变换</span></span><br><span class="line">    b_array = _non_linear_map(_byte_unpack(byte4))</span><br><span class="line">    <span class="comment"># 线性变换L&#x27;</span></span><br><span class="line">    <span class="keyword">return</span> _linear_map_s(_byte_pack(b_array))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">_round_keys</span>(<span class="params">mk</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    轮密钥由加密密钥通过密钥扩展算法生成</span></span><br><span class="line"><span class="string">    加密密钥MK = (MK0, MK1, MK2, MK3)</span></span><br><span class="line"><span class="string">    轮密钥生成算法:</span></span><br><span class="line"><span class="string">    (K0, K1, K2, K3) = (MK0 ⊕ FK0, MK1 ⊕ FK1, MK2 ⊕ FK2, MK3 ⊕ FK3)</span></span><br><span class="line"><span class="string">    rki = Ki+4 = Ki⊕T&#x27;(Ki+1 ⊕ Ki+2 ⊕ Ki+3 ⊕ CKi) i=0, 1,...,31</span></span><br><span class="line"><span class="string">    :param mk: 加密密钥, 16byte, 128bit</span></span><br><span class="line"><span class="string">    :return list</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="comment"># 尝试从轮密钥缓存中获取轮密钥</span></span><br><span class="line">    <span class="comment"># 没有获取到, 根据密钥扩展算法生成</span></span><br><span class="line">    _rk_keys = _rk_cache.get(mk)</span><br><span class="line">    <span class="keyword">if</span> _rk_keys <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">        mk0, mk1, mk2, mk3 = _byte_unpack(mk, byte_n=<span class="number">16</span>)</span><br><span class="line">        keys = [mk0 ^ FK[<span class="number">0</span>], mk1 ^ FK[<span class="number">1</span>], mk2 ^ FK[<span class="number">2</span>], mk3 ^ FK[<span class="number">3</span>]]</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> _<span class="built_in">range</span>(<span class="number">32</span>):</span><br><span class="line">            rk = keys[i] ^ _rep_t_s(keys[i + <span class="number">1</span>] ^ keys[i + <span class="number">2</span>] ^ keys[i + <span class="number">3</span>] ^ CK[i])</span><br><span class="line">            keys.append(rk)</span><br><span class="line">        _rk_keys = keys[<span class="number">4</span>:]</span><br><span class="line">        <span class="comment"># 加入轮密钥缓存中</span></span><br><span class="line">        _rk_cache[mk] = _rk_keys</span><br><span class="line">    <span class="keyword">return</span> _rk_keys</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">_round_f</span>(<span class="params">byte4_array, rk</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    轮函数, F(X0, X1, X2, X3, rk) = X0 ⊕ T(X1 ⊕ X2 ⊕ X3 ⊕ rk)</span></span><br><span class="line"><span class="string">    :param byte4_array: (X0, X1, X2, X3), 每一项4byte, 32bit</span></span><br><span class="line"><span class="string">    :param rk: 轮密钥, 4byte, 32bit</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    x0, x1, x2, x3 = byte4_array</span><br><span class="line">    <span class="keyword">return</span> x0 ^ _rep_t(x1 ^ x2 ^ x3 ^ rk)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">_crypt</span>(<span class="params">num, mk, mode=SM4_ENCRYPT</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    SM4加密和解密</span></span><br><span class="line"><span class="string">    :param num: 密文或明文 16byte</span></span><br><span class="line"><span class="string">    :param mk:  密钥 16byte</span></span><br><span class="line"><span class="string">    :param mode: 轮密钥顺序</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    x_keys = <span class="built_in">list</span>(_byte_unpack(num, byte_n=<span class="number">16</span>))</span><br><span class="line">    round_keys = _round_keys(mk)</span><br><span class="line">    <span class="keyword">if</span> mode == SM4_DECRYPT:</span><br><span class="line">        round_keys = round_keys[::-<span class="number">1</span>]</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> _<span class="built_in">range</span>(<span class="number">32</span>):</span><br><span class="line">        x_keys.append(_round_f(x_keys[i:i + <span class="number">4</span>], round_keys[i]))</span><br><span class="line">    <span class="keyword">return</span> _byte_pack(x_keys[-<span class="number">4</span>:][::-<span class="number">1</span>], byte_n=<span class="number">16</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">encrypt</span>(<span class="params">clear_num, mk</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    SM4加密算法由32次迭代运算和1次反序变换R组成.</span></span><br><span class="line"><span class="string">    明文输入为(X0, X1, X2, X3), 每一项4byte, 密文输出为(Y0, Y1, Y2, Y3), 每一项4byte</span></span><br><span class="line"><span class="string">    轮密钥为rki, i=0,1,...,32, 4byte, 运算过程如下:</span></span><br><span class="line"><span class="string">    1). 32次迭代运算: Xi+4 = F(Xi, Xi+1, Xi+2, Xi+3, rki), i=0,1,...,32</span></span><br><span class="line"><span class="string">    2). 反序变换: (Y0, Y1, Y2, Y3) = (X35, X34, X33, X32)</span></span><br><span class="line"><span class="string">    :param clear_num: 明文, 16byte</span></span><br><span class="line"><span class="string">    :param mk: 密钥, 16byte</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">return</span> _crypt(num=clear_num, mk=mk)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">decrypt</span>(<span class="params">cipher_num, mk</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    SM4解密算法, 解密变换与加密变换结构相同, 不同的仅是轮密钥的使用顺序.</span></span><br><span class="line"><span class="string">    解密时轮密钥使用顺序为(rk31,rk30,...,rk0)</span></span><br><span class="line"><span class="string">    :param cipher_num: 密文, 16byte</span></span><br><span class="line"><span class="string">    :param mk: 密钥, 16byte</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">return</span> _crypt(num=cipher_num, mk=mk, mode=SM4_DECRYPT)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">_padding</span>(<span class="params">text, mode=SM4_ENCRYPT</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    加密填充和解密去填充</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="comment"># python2 is (basestring, )</span></span><br><span class="line">    <span class="comment"># python3 is (str, bytes)</span></span><br><span class="line">    _str_or_bytes = string_types <span class="keyword">if</span> PY2 <span class="keyword">else</span> (string_types + (binary_type,))</span><br><span class="line">    <span class="keyword">if</span> text <span class="keyword">is</span> <span class="literal">None</span> <span class="keyword">or</span> <span class="keyword">not</span> <span class="built_in">isinstance</span>(text, _str_or_bytes):</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># unicode</span></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">isinstance</span>(text, text_type):</span><br><span class="line">        text = text.encode(encoding=E_FMT)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> mode == SM4_ENCRYPT:</span><br><span class="line">        <span class="comment"># 填充</span></span><br><span class="line">        p_num = BLOCK_BYTE - (<span class="built_in">len</span>(text) % BLOCK_BYTE)</span><br><span class="line">        space = <span class="string">&#x27;&#x27;</span> <span class="keyword">if</span> PY2 <span class="keyword">else</span> <span class="string">b&#x27;&#x27;</span></span><br><span class="line">        pad_s = (<span class="built_in">chr</span>(p_num) * p_num) <span class="keyword">if</span> PY2 <span class="keyword">else</span> (<span class="built_in">chr</span>(p_num).encode(E_FMT) * p_num)</span><br><span class="line">        res = space.join([text, pad_s])</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="comment"># 去填充</span></span><br><span class="line">        p_num = <span class="built_in">ord</span>(text[-<span class="number">1</span>]) <span class="keyword">if</span> PY2 <span class="keyword">else</span> text[-<span class="number">1</span>]</span><br><span class="line">        res = text[:-p_num]</span><br><span class="line">    <span class="keyword">return</span> res</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">_key_iv_check</span>(<span class="params">key_iv</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    密钥或初始化向量检测</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="comment"># 密钥</span></span><br><span class="line">    <span class="keyword">if</span> key_iv <span class="keyword">is</span> <span class="literal">None</span> <span class="keyword">or</span> <span class="keyword">not</span> <span class="built_in">isinstance</span>(key_iv, (string_types, binary_type)):</span><br><span class="line">        <span class="keyword">raise</span> TypeError(<span class="string">&#x27;Parameter key or iv:&#123;&#125; not string_types or binary_type&#x27;</span>.<span class="built_in">format</span>(key_iv))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">isinstance</span>(key_iv, text_type):</span><br><span class="line">        key_iv = key_iv.encode(encoding=E_FMT)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(key_iv) &gt; BLOCK_BYTE:</span><br><span class="line">        <span class="keyword">raise</span> ValueError(<span class="string">&#x27;Parameter key or iv:&#123;&#125; byte greater than &#123;&#125;&#x27;</span>.<span class="built_in">format</span>(key_iv.decode(E_FMT),</span><br><span class="line">                                                                              BLOCK_BYTE))</span><br><span class="line">    <span class="keyword">return</span> key_iv</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">_hex</span>(<span class="params">str_or_bytes</span>):</span><br><span class="line">    <span class="comment"># PY2: _hex(&#x27;北京&#x27;) --&gt; &#x27;e58c97e4baac&#x27;</span></span><br><span class="line">    <span class="comment"># PY3: _hex(&#x27;北京&#x27;) --&gt; b&#x27;e58c97e4baac&#x27;</span></span><br><span class="line">    <span class="keyword">if</span> PY2:</span><br><span class="line">        hex_str = hexlify(str_or_bytes)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="comment"># python3</span></span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">isinstance</span>(str_or_bytes, text_type):</span><br><span class="line">            byte = str_or_bytes.encode(encoding=E_FMT)</span><br><span class="line">        <span class="keyword">elif</span> <span class="built_in">isinstance</span>(str_or_bytes, binary_type):</span><br><span class="line">            byte = str_or_bytes</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            byte = <span class="string">b&#x27;&#x27;</span></span><br><span class="line">        hex_str = hexlify(byte)</span><br><span class="line">    <span class="keyword">return</span> hex_str</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">_unhex</span>(<span class="params">hex_str</span>):</span><br><span class="line">    <span class="comment"># PY2: _unhex(&#x27;e58c97e4baac&#x27;) --&gt; &#x27;\xe5\x8c\x97\xe4\xba\xac&#x27;</span></span><br><span class="line">    <span class="comment"># PY3: _unhex(&#x27;e58c97e4baac&#x27;) --&gt; b&#x27;\xe5\x8c\x97\xe4\xba\xac&#x27;</span></span><br><span class="line">    <span class="keyword">return</span> unhexlify(hex_str)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 电子密码本(ECB)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">encrypt_ecb</span>(<span class="params">plain_text, key</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    SM4(ECB)加密</span></span><br><span class="line"><span class="string">    :param plain_text: 明文</span></span><br><span class="line"><span class="string">    :param key: 密钥, 小于等于16字节</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    plain_text = _padding(plain_text, mode=SM4_ENCRYPT)</span><br><span class="line">    <span class="keyword">if</span> plain_text <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 密钥检验</span></span><br><span class="line">    key = _key_iv_check(key_iv=key)</span><br><span class="line"></span><br><span class="line">    plain_hex = _<span class="built_in">hex</span>(plain_text)</span><br><span class="line">    cipher_hex_list = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> _<span class="built_in">range</span>(<span class="built_in">len</span>(plain_text) // BLOCK_BYTE):</span><br><span class="line">        sub_hex = plain_hex[i * BLOCK_HEX:(i + <span class="number">1</span>) * BLOCK_HEX]</span><br><span class="line">        cipher = encrypt(clear_num=<span class="built_in">int</span>(sub_hex, <span class="number">16</span>),</span><br><span class="line">                         mk=<span class="built_in">int</span>(_<span class="built_in">hex</span>(key), <span class="number">16</span>))</span><br><span class="line">        cipher_hex_list.append(num2hex(num=cipher, width=BLOCK_HEX))</span><br><span class="line"></span><br><span class="line">    cipher_text = b64encode(_unhex(<span class="string">&#x27;&#x27;</span>.join(cipher_hex_list)))</span><br><span class="line">    <span class="keyword">return</span> cipher_text <span class="keyword">if</span> PY2 <span class="keyword">else</span> cipher_text.decode(E_FMT)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">decrypt_ecb</span>(<span class="params">cipher_text, key</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    SM4(ECB)解密</span></span><br><span class="line"><span class="string">    :param cipher_text: 密文</span></span><br><span class="line"><span class="string">    :param key: 密钥, 小于等于16字节</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    cipher_text = b64decode(cipher_text)</span><br><span class="line">    cipher_hex = _<span class="built_in">hex</span>(cipher_text)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 密码检验</span></span><br><span class="line">    key = _key_iv_check(key_iv=key)</span><br><span class="line">    plain_hex_list = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> _<span class="built_in">range</span>(<span class="built_in">len</span>(cipher_text) // BLOCK_BYTE):</span><br><span class="line">        sub_hex = cipher_hex[i * BLOCK_HEX:(i + <span class="number">1</span>) * BLOCK_HEX]</span><br><span class="line">        plain = decrypt(cipher_num=<span class="built_in">int</span>(sub_hex, <span class="number">16</span>),</span><br><span class="line">                        mk=<span class="built_in">int</span>(_<span class="built_in">hex</span>(key), <span class="number">16</span>))</span><br><span class="line">        plain_hex_list.append(num2hex(num=plain, width=BLOCK_HEX))</span><br><span class="line"></span><br><span class="line">    plain_text = _padding(_unhex(<span class="string">&#x27;&#x27;</span>.join(plain_hex_list)),</span><br><span class="line">                          mode=SM4_DECRYPT)</span><br><span class="line">    <span class="keyword">return</span> plain_text <span class="keyword">if</span> PY2 <span class="keyword">else</span> plain_text.decode(E_FMT)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 密码块链接(CBC)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">encrypt_cbc</span>(<span class="params">plain_text, key, iv</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    SM4(CBC)加密</span></span><br><span class="line"><span class="string">    :param plain_text: 明文</span></span><br><span class="line"><span class="string">    :param key: 密钥, 小于等于16字节</span></span><br><span class="line"><span class="string">    :param iv: 初始化向量, 小于等于16字节</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    plain_text = _padding(plain_text, mode=SM4_ENCRYPT)</span><br><span class="line">    <span class="keyword">if</span> plain_text <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 密钥检验</span></span><br><span class="line">    key = _key_iv_check(key_iv=key)</span><br><span class="line">    <span class="comment"># 初始化向量监测</span></span><br><span class="line">    iv = _key_iv_check(key_iv=iv)</span><br><span class="line"></span><br><span class="line">    plain_hex = _<span class="built_in">hex</span>(plain_text)</span><br><span class="line">    ivs = [<span class="built_in">int</span>(_<span class="built_in">hex</span>(iv), <span class="number">16</span>)]</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> _<span class="built_in">range</span>(<span class="built_in">len</span>(plain_text) // BLOCK_BYTE):</span><br><span class="line">        sub_hex = plain_hex[i * BLOCK_HEX:(i + <span class="number">1</span>) * BLOCK_HEX]</span><br><span class="line">        cipher = encrypt(clear_num=(<span class="built_in">int</span>(sub_hex, <span class="number">16</span>) ^ ivs[i]),</span><br><span class="line">                         mk=<span class="built_in">int</span>(_<span class="built_in">hex</span>(key), <span class="number">16</span>))</span><br><span class="line">        ivs.append(cipher)</span><br><span class="line"></span><br><span class="line">    cipher_text = b64encode(_unhex(<span class="string">&#x27;&#x27;</span>.join([num2hex(num=c, width=BLOCK_HEX)</span><br><span class="line">                                            <span class="keyword">for</span> c <span class="keyword">in</span> ivs[<span class="number">1</span>:]])))</span><br><span class="line">    <span class="keyword">return</span> cipher_text <span class="keyword">if</span> PY2 <span class="keyword">else</span> cipher_text.decode(E_FMT)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">decrypt_cbc</span>(<span class="params">cipher_text, key, iv</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    SM4(CBC)解密</span></span><br><span class="line"><span class="string">    :param cipher_text: 密文</span></span><br><span class="line"><span class="string">    :param key: 密钥 小于等于16字节</span></span><br><span class="line"><span class="string">    :param iv: 初始化向量 小于等于16字节</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    cipher_text = b64decode(cipher_text)</span><br><span class="line">    cipher_hex = _<span class="built_in">hex</span>(cipher_text)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 密钥检测</span></span><br><span class="line">    key = _key_iv_check(key_iv=key)</span><br><span class="line">    <span class="comment"># 初始化向量检测</span></span><br><span class="line">    iv = _key_iv_check(key_iv=iv)</span><br><span class="line">    ivs = [<span class="built_in">int</span>(_<span class="built_in">hex</span>(iv), <span class="number">16</span>)]</span><br><span class="line">    plain_hex_list = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> _<span class="built_in">range</span>(<span class="built_in">len</span>(cipher_text) // BLOCK_BYTE):</span><br><span class="line">        sub_hex = cipher_hex[i * BLOCK_HEX:(i + <span class="number">1</span>) * BLOCK_HEX]</span><br><span class="line">        cipher = <span class="built_in">int</span>(sub_hex, <span class="number">16</span>)</span><br><span class="line">        plain = (ivs[i] ^ decrypt(cipher_num=cipher,</span><br><span class="line">                                  mk=<span class="built_in">int</span>(_<span class="built_in">hex</span>(key), <span class="number">16</span>)))</span><br><span class="line">        ivs.append(cipher)</span><br><span class="line">        plain_hex_list.append(num2hex(num=plain, width=BLOCK_HEX))</span><br><span class="line"></span><br><span class="line">    plain_text = _padding(_unhex(<span class="string">&#x27;&#x27;</span>.join(plain_hex_list)),</span><br><span class="line">                          mode=SM4_DECRYPT)</span><br><span class="line">    <span class="keyword">return</span> plain_text <span class="keyword">if</span> PY2 <span class="keyword">else</span> plain_text.decode(E_FMT)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">ModuleInfo = DefineModule(name=<span class="string">&quot;DataUtils&quot;</span>, author=<span class="string">&quot;b&quot;</span>, version=<span class="string">&quot;1.0&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@ModuleInfo.plugin(<span class="params"><span class="string">&quot;wb.sqlide.decryptData&quot;</span>, caption=<span class="string">&quot;decrypt data from resultSet&quot;</span>,</span></span></span><br><span class="line"><span class="params"><span class="meta">                   <span class="built_in">input</span>=[wbinputs.currentResultset(<span class="params"></span>), wbinputs.currentEditableResultset(<span class="params"></span>)], pluginMenu=<span class="string">&quot;SQL/Utilities&quot;</span>,</span></span></span><br><span class="line"><span class="params"><span class="meta">                   accessibilityName=<span class="string">&quot;decryptData from resultSet&quot;</span></span>)</span></span><br><span class="line"><span class="meta">@ModuleInfo.export(<span class="params">grt.INT, grt.classes.db_query_Resultset, grt.classes.db_query_EditableResultset</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">decryptData</span>(<span class="params">result_set, edit_result_set</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;decryptData from resultSet</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        row_count = result_set.rowCount</span><br><span class="line">        column_count = <span class="built_in">len</span>(result_set.columns)</span><br><span class="line">        log_info(<span class="built_in">str</span>(row_count) + <span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line">        log_info(<span class="built_in">str</span>(column_count) + <span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line">        <span class="keyword">for</span> a <span class="keyword">in</span> <span class="built_in">range</span>(row_count - <span class="number">1</span>):</span><br><span class="line">            result_set.goToRow(a)</span><br><span class="line">            edit_column(result_set, edit_result_set, column_count)</span><br><span class="line">            result_set.nextRow()</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        log_info(<span class="built_in">str</span>(e) + <span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">edit_column</span>(<span class="params">result_set, edit_result_set, column_count</span>):</span><br><span class="line">    <span class="keyword">for</span> a <span class="keyword">in</span> <span class="built_in">range</span>(column_count - <span class="number">1</span>):</span><br><span class="line">        value = result_set.stringFieldValue(a)</span><br><span class="line">        log_info(value + <span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line">        <span class="keyword">if</span> value.startswith(<span class="string">&#x27;enc:&#x27;</span>):</span><br><span class="line">            b = binascii.unhexlify(value[<span class="number">4</span>:])</span><br><span class="line">            data = base64.b64encode(b).decode()</span><br><span class="line">            edit_result_set.setStringFieldValue(a, decrypt_ecb(data, key))</span><br></pre></td></tr></table></figure><h3 id="插件效果"><a href="#插件效果" class="headerlink" title="插件效果"></a>插件效果</h3><p>上面的插件实现的功能是，在通过 SQL 查询完数据之后，点击 <code>decryptData from resultSet</code> 即可自动解密查询结果中被加密的数据。由于用到了 SM4 来解密，所以这里为了不引入外部依赖，将 <code>pysm4</code> 这个库的源码放到同一个插件脚本里面了，所以上面的一大堆方法都是 <code>pysm4</code> 里面的，可以先忽略。</p><p><img data-src="https://blogimg.d77.xyz/image-20241112231017602.png" alt="image-20241112231017602"></p><p>执行插件前：</p><p><img data-src="https://blogimg.d77.xyz/image-20241112231212018.png" alt="image-20241112231212018"></p><p>执行插件后，<code>enc</code> 前缀已经没有了，自动解密出来原始的数据了。</p><p><img data-src="https://blogimg.d77.xyz/image-20241112231237059.png" alt="image-20241112231237059"></p><h2 id="插件编写"><a href="#插件编写" class="headerlink" title="插件编写"></a>插件编写</h2><p>首先，需要使用 <code>DefineModule</code> 来实例化一个对象，用这个对象来注册插件，通过装饰器的方式，<code>DefineModule</code> 中会定义名字，作者，版本等信息。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">ModuleInfo = DefineModule(name=<span class="string">&quot;DataUtils&quot;</span>, author=<span class="string">&quot;b&quot;</span>, version=<span class="string">&quot;1.0&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">@ModuleInfo.plugin(<span class="params"><span class="string">&quot;wb.sqlide.decryptData&quot;</span>, caption=<span class="string">&quot;decrypt data from resultSet&quot;</span>,</span></span></span><br><span class="line"><span class="params"><span class="meta">                   <span class="built_in">input</span>=[wbinputs.currentResultset(<span class="params"></span>), wbinputs.currentEditableResultset(<span class="params"></span>)], pluginMenu=<span class="string">&quot;SQL/Utilities&quot;</span>,</span></span></span><br><span class="line"><span class="params"><span class="meta">                   accessibilityName=<span class="string">&quot;decryptData from resultSet&quot;</span></span>)</span></span><br><span class="line"><span class="meta">@ModuleInfo.export(<span class="params">grt.INT, grt.classes.db_query_Resultset, grt.classes.db_query_EditableResultset</span>)</span></span><br></pre></td></tr></table></figure><p>这里要注意几点：</p><ul><li><code>@ModuleInfo.plugin</code> 中的参数，第一个”wb.sqlide.decryptData”是可以自定义的</li><li><code>caption</code> 是插件的说明，也可以自定义</li><li>input 参数是根据你的需求，例如要操作 <code>Resultset</code> 对象，就去 <code>wbinputs</code> 中去找返回 <code>Resultset</code> 类型的方法，这里我额外用到了 <code>EditableResultset</code> 对象，因为我还要对 <code>Resultset</code> 中的某行数据进行更改。</li><li><code>pluginMenu</code> 就是在菜单中的位置，可以更改。</li><li><code>@ModuleInfo.export</code> 中的参数，第一个参数是返回值的类型，后面的所有参数都是要注册的插件的参数，和刚才的 <code>inputs</code> 参数的类型和数量要一致。</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">decryptData</span>(<span class="params">result_set, edit_result_set</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;decryptData from resultSet</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        row_count = result_set.rowCount</span><br><span class="line">        column_count = <span class="built_in">len</span>(result_set.columns)</span><br><span class="line">        log_info(<span class="built_in">str</span>(row_count) + <span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line">        log_info(<span class="built_in">str</span>(column_count) + <span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line">        <span class="keyword">for</span> a <span class="keyword">in</span> <span class="built_in">range</span>(row_count - <span class="number">1</span>):</span><br><span class="line">            result_set.goToRow(a)</span><br><span class="line">            edit_column(result_set, edit_result_set, column_count)</span><br><span class="line">            result_set.nextRow()</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        log_info(<span class="built_in">str</span>(e) + <span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span></span><br></pre></td></tr></table></figure><p>自定义的插件方法，参数的数量和类型要和刚才定义的一致，返回值的类型也要和刚才定义的一致。</p><p>完成以上内容后就可以开始编写插件的逻辑了，插件的逻辑比较简单，这里我就不详细分析了。主要的功能就是实现一个解密函数，对 <code>Resultset</code> 中某行的加密数据进行解密。</p><h2 id="注意事项"><a href="#注意事项" class="headerlink" title="注意事项"></a>注意事项</h2><p>插件写完了，说几点注意事项。</p><ul><li>插件的加载是通过 Python 进行的，所以每次插件的更改都要重启 MySQL Workbench 才能生效。</li><li>需要输出日志的话可以自己在 Python 中写文件，也可以通过 <code>from workbench.log import log_info</code> 的方式把日志打印到软件的日志里面。</li><li>MySQL Workbench 的插件其实是可以调用外部依赖的，不过我没有在官方的文档中找到教程，自己摸索了一下，可以把外部依赖文件夹手动复制到 C:\Program Files\MySQL\MySQL Workbench 8.0 CE\python\site-packages 这个路径中，即可在插件中直接 <code>import</code> 调用了。</li><li><code>Resultset</code> 类型和 <code>EditableResultset</code> 类型应该有继承关系，<code>EditableResultset</code> 也可以用 <code>Resultset</code> 的属性和方法。</li></ul><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>MySQL Workbench 的文档写的太差了，好多用法都没有明确的文档，还得靠自己猜和看官方的脚本才能知道怎么用，不过最终花了几个小时还是搞定了这个功能。</p><blockquote><p>本文章首发于个人博客 <strong>LLLibra146’s blog</strong></p><p><strong>本文作者</strong>：LLLibra146</p><p>更多文章请关注公众号 (LLLibra146)：<img data-src="https://blogimg.d77.xyz/qrcode_for_gh_10d7d04417bb_430.jpg" alt="LLLibra146"></p><p><strong>版权声明</strong>：本博客所有文章除特别声明外，均采用 © <a target="_blank" rel="noopener external nofollow noreferrer" href="https://creativecommons.org/licenses/by-nc-nd/4.0/deed.zh">BY-NC-ND</a> 许可协议。非商用转载请注明出处！严禁商业转载！</p><p><strong>本文链接</strong>：<br><a href="https://blog.d77.xyz/archives/f4f691af.html">https://blog.d77.xyz/archives/f4f691af.html</a></p></blockquote></div><footer class="post-footer"><div class="post-tags"><a href="/tags/MySQL/" rel="tag"><i class="fa fa-tag"></i> MySQL</a> <a href="/tags/MySQL-Workbench/" rel="tag"><i class="fa fa-tag"></i> MySQL Workbench</a> <a href="/tags/%E6%8F%92%E4%BB%B6/" rel="tag"><i class="fa fa-tag"></i> 插件</a> <a href="/tags/%E6%8F%92%E4%BB%B6%E7%BC%96%E5%86%99/" rel="tag"><i class="fa fa-tag"></i> 插件编写</a></div><div class="post-nav"><div class="post-nav-item"><a href="/archives/b708c662.html" rel="prev" title="告别复杂判断！Python中实现函数重载的终极技巧"><i class="fa fa-angle-left"></i> 告别复杂判断！Python中实现函数重载的终极技巧</a></div><div class="post-nav-item"><a href="/archives/4cbeb126.html" rel="next" title="从此告别代码泄露！提高Python性能的必备技巧">从此告别代码泄露！提高Python性能的必备技巧 <i class="fa fa-angle-right"></i></a></div></div></footer></article></div><div class="comments giscus-container"></div></div></main><footer class="footer"><div class="footer-inner"><div class="beian"><a href="https://beian.miit.gov.cn/" rel="noopener external nofollow noreferrer" target="_blank">津ICP备15003765号</a></div><div class="copyright">&copy; 2019 – <span itemprop="copyrightYear">2025</span> <span class="with-love"><i class="fa fa-heart"></i> </span><span class="author" itemprop="copyrightHolder">LLLibra146</span></div><div class="powered-by">由 <a href="https://hexo.io/" rel="noopener external nofollow noreferrer" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/pisces/" rel="noopener external nofollow noreferrer" target="_blank">NexT.Pisces</a> 强力驱动</div></div></footer><div class="toggle sidebar-toggle" role="button"><span class="toggle-line"></span> <span class="toggle-line"></span> <span class="toggle-line"></span></div><div class="sidebar-dimmer"></div><div class="back-to-top" role="button" aria-label="返回顶部"><i class="fa fa-arrow-up fa-lg"></i> <span>0%</span></div><a href="https://github.com/libra146" class="github-corner" title="在 GitHub 上关注我" aria-label="在 GitHub 上关注我" rel="noopener external nofollow noreferrer" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin:130px 106px" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a><noscript><div class="noscript-warning">Theme NexT works best with JavaScript enabled</div></noscript><script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/next-theme-pjax/0.6.0/pjax.min.js" integrity="sha256-vxLn1tSKWD4dqbMRyv940UYw4sXgMtYcK6reefzZrao=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fancyapps-ui/5.0.31/fancybox/fancybox.umd.js" integrity="sha256-a+H7FYzJv6oU2hfsfDGM2Ohw/cR9v+hPfxHCLdmCrE8=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/lozad.js/1.16.0/lozad.min.js" integrity="sha256-mOFREFhqmHeQbXpK2lp4nA3qooVgACfh88fpJftLBbc=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/pangu/4.0.7/pangu.min.js" integrity="sha256-j+yj56cdEY2CwkVtGyz18fNybFGpMGJ8JxG3GSyO2+I=" crossorigin="anonymous"></script><script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/sidebar.js"></script><script src="/js/next-boot.js"></script><script src="/js/pjax.js"></script><script src="/js/third-party/fancybox.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/quicklink/2.3.0/quicklink.umd.js" integrity="sha256-yvJQOINiH9fWemHn0vCA5lsHWJaHs6/ZmO+1Ft04SvM=" crossorigin="anonymous"></script><script class="next-config" data-name="quicklink" type="application/json">{"enable":true,"home":false,"archive":false,"delay":true,"timeout":3000,"priority":true,"url":"https://blog.d77.xyz/archives/f4f691af.html"}</script><script src="/js/third-party/quicklink.js"></script><script class="next-config" data-name="giscus" type="application/json">{"enable":true,"repo":"libra146/libra146.github.io","repo_id":"MDEwOlJlcG9zaXRvcnkxOTI0ODgxODA","category":"Announcements","category_id":"DIC_kwDOC3ki9M4CYegl","mapping":"pathname","strict":0,"reactions_enabled":1,"emit_metadata":0,"theme":"light","lang":"zh-CN","crossorigin":"anonymous","input_position":"bottom","loading":"lazy"}</script><script>document.addEventListener("page:loaded",()=>{CONFIG.page.comments&&NexT.utils.loadComments(".giscus-container").then(()=>NexT.utils.getScript("https://giscus.app/client.js",{attributes:{async:!0,crossOrigin:"anonymous","data-repo":CONFIG.giscus.repo,"data-repo-id":CONFIG.giscus.repo_id,"data-category":CONFIG.giscus.category,"data-category-id":CONFIG.giscus.category_id,"data-mapping":CONFIG.giscus.mapping,"data-strict":CONFIG.giscus.strict,"data-reactions-enabled":CONFIG.giscus.reactions_enabled,"data-emit-metadata":CONFIG.giscus.emit_metadata,"data-theme":CONFIG.giscus.theme,"data-lang":CONFIG.giscus.lang,"data-input-position":CONFIG.giscus.input_position,"data-loading":CONFIG.giscus.loading},parentNode:document.querySelector(".giscus-container")}))})</script></body></html>